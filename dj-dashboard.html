<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="DJ Dashboard - Externally Yours Productions, LLC">
    <title>DJ Dashboard - Externally Yours Productions, LLC</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1a1a1a;
            --secondary-color: #ffffff;
            --accent-color: #ff6b35;
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #f8f8f8;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        /* Header */
        .dashboard-header {
            background: var(--primary-color);
            color: var(--secondary-color);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .dashboard-header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dashboard-header img {
            height: 50px;
            width: auto;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .logout-btn {
            padding: 0.5rem 1rem;
            background: var(--accent-color);
            color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #e55a2b;
        }

        /* Main Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Dashboard Layout */
        .dashboard-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1024px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Tabs - Only for bookings filter now */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-button {
            padding: 1rem 2rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }

        .tab-button:hover {
            color: var(--primary-color);
        }

        /* Calendar Section */
        .calendar-section {
            background: var(--secondary-color);
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        /* Visual Calendar Widget */
        .calendar-widget {
            background: var(--bg-light);
            border-radius: 10px;
            padding: 0.75rem;
            margin-bottom: 2rem;
            max-width: 400px;
        }

        .calendar-widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .calendar-widget-header h3 {
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .calendar-nav-btn {
            background: var(--accent-color);
            color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.75rem;
            transition: background 0.3s ease;
        }

        .calendar-nav-btn:hover {
            background: #e55a2b;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            color: var(--text-light);
            padding: 0.25rem;
            font-size: 0.65rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--secondary-color);
            position: relative;
        }

        .calendar-day:hover {
            background: var(--bg-light);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            background: var(--accent-color);
            color: var(--secondary-color);
            font-weight: bold;
        }

        .calendar-day.blocked {
            background: var(--warning-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .calendar-day.has-booking {
            background: var(--success-color);
            color: var(--secondary-color);
            font-weight: bold;
        }

        .calendar-day-number {
            font-size: 0.65rem;
        }

        .calendar-day-indicator {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            margin-top: 1px;
        }

        .calendar-day.blocked .calendar-day-indicator {
            background: var(--primary-color);
        }

        .calendar-day.has-booking .calendar-day-indicator {
            background: var(--secondary-color);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-header h2 {
            color: var(--primary-color);
        }

        .block-date-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .form-input {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--accent-color);
            color: var(--secondary-color);
        }

        .btn-primary:hover {
            background: #e55a2b;
        }

        .btn-danger {
            background: var(--error-color);
            color: var(--secondary-color);
        }

        .btn-danger:hover {
            background: #c82333;
        }

        /* Blocked Dates List */
        .blocked-dates-list {
            margin-top: 2rem;
        }

        .blocked-date-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }

        .blocked-date-info {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .date-badge {
            padding: 0.25rem 0.75rem;
            background: var(--warning-color);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* Bookings Section */
        .bookings-section {
            background: var(--secondary-color);
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .bookings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .bookings-header h2 {
            color: var(--primary-color);
        }

        .bookings-filter {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-light);
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: var(--accent-color);
            color: var(--secondary-color);
            border-color: var(--accent-color);
        }

        .bookings-list {
            display: grid;
            gap: 1rem;
        }

        .booking-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .booking-card:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .booking-card.upcoming {
            border-left: 4px solid var(--success-color);
        }

        .booking-card.past {
            border-left: 4px solid var(--text-light);
            opacity: 0.7;
        }

        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .booking-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .booking-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .booking-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .booking-detail-item {
            display: flex;
            flex-direction: column;
        }

        .booking-detail-label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
        }

        .booking-detail-value {
            font-weight: 500;
            color: var(--text-dark);
        }

        .reminder-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--info-color);
            color: var(--secondary-color);
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .block-date-form {
                flex-direction: column;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
            }

            .tabs {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <h1>
            <img src="EYP Logo_New.png" alt="Externally Yours Productions, LLC">
            DJ Dashboard
        </h1>
        <div class="header-actions">
            <div style="text-align: right; margin-right: 1rem;">
                <div style="font-size: 0.85rem; color: #999;">Logged in as</div>
                <div id="user-name" style="font-weight: bold; font-size: 1.1rem;">DJ User</div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Calendar Section - Always Visible -->
        <div class="calendar-section">
            <div class="calendar-header">
                <h2>Calendar & Block Dates</h2>
            </div>
            
            <!-- Visual Calendar Widget -->
            <div class="calendar-widget">
                <div class="calendar-widget-header">
                    <button class="calendar-nav-btn" onclick="previousMonth()">‚Üê Prev</button>
                    <h3 id="calendar-month-year">January 2025</h3>
                    <button class="calendar-nav-btn" onclick="nextMonth()">Next ‚Üí</button>
                </div>
                <div id="calendar-grid-container">
                    <!-- Calendar grid will be generated here -->
                </div>
            </div>

            <form class="block-date-form" id="block-date-form">
                <input type="text" id="block-date" class="form-input" placeholder="Select date to block" required>
                <input type="text" id="block-reason" class="form-input" placeholder="Reason (optional)" style="flex: 1;">
                <button type="submit" class="btn btn-primary">Block Date</button>
            </form>

            <div class="blocked-dates-list">
                <h3 style="margin-bottom: 1rem; color: var(--primary-color);">Blocked Dates</h3>
                <div id="blocked-dates-container">
                    <!-- Blocked dates will be populated here -->
                </div>
            </div>
        </div>

        <!-- Bookings Section - Always Visible -->
        <div class="bookings-section">
            <div class="bookings-header">
                <h2>Current Bookings</h2>
                <div class="bookings-filter">
                    <button class="filter-btn active" onclick="filterBookings('all')">All</button>
                    <button class="filter-btn" onclick="filterBookings('upcoming')">Upcoming</button>
                    <button class="filter-btn" onclick="filterBookings('past')">Past</button>
                </div>
            </div>
            <div id="bookings-container" class="bookings-list">
                <!-- Bookings will be populated here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Check authentication
        if (!localStorage.getItem('dj_token')) {
            window.location.href = 'dj-login.html';
        }

        // Initialize calendar picker
        flatpickr("#block-date", {
            dateFormat: "Y-m-d",
            minDate: "today",
            disable: []
        });

        // Load user data
        const currentUser = localStorage.getItem('dj_user') || 'DJ User';
        document.getElementById('user-name').textContent = currentUser;

        // Block date form submission
        document.getElementById('block-date-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const date = document.getElementById('block-date').value;
            const reason = document.getElementById('block-reason').value;

            if (!date) {
                alert('Please select a date');
                return;
            }

            // TODO: Send to backend API
            // For now, store in localStorage
            const blockedDates = JSON.parse(localStorage.getItem('blocked_dates') || '[]');
            blockedDates.push({
                date: date,
                reason: reason || 'No reason provided',
                blockedAt: new Date().toISOString()
            });
            localStorage.setItem('blocked_dates', JSON.stringify(blockedDates));

            // Update calendar picker to disable blocked date
            const fp = flatpickr("#block-date");
            fp.config.disable.push(date);
            fp.set('disable', fp.config.disable);

            // Refresh blocked dates list and calendar
            displayBlockedDates();
            generateCalendar();

            // Clear form
            document.getElementById('block-date-form').reset();
        });

        // Display blocked dates
        function displayBlockedDates() {
            const blockedDates = JSON.parse(localStorage.getItem('blocked_dates') || '[]');
            const container = document.getElementById('blocked-dates-container');

            if (blockedDates.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No dates blocked</p></div>';
                return;
            }

            container.innerHTML = blockedDates.map(item => {
                const dateObj = new Date(item.date);
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                return `
                    <div class="blocked-date-item">
                        <div class="blocked-date-info">
                            <span class="date-badge">${item.date}</span>
                            <div>
                                <strong>${formattedDate}</strong>
                                ${item.reason ? `<div style="color: var(--text-light); font-size: 0.9rem;">${item.reason}</div>` : ''}
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="unblockDate('${item.date}')">Unblock</button>
                    </div>
                `;
            }).join('');
        }

        // Unblock date
        function unblockDate(date) {
            if (!confirm('Are you sure you want to unblock this date?')) return;

            const blockedDates = JSON.parse(localStorage.getItem('blocked_dates') || '[]');
            const filtered = blockedDates.filter(item => item.date !== date);
            localStorage.setItem('blocked_dates', JSON.stringify(filtered));

            // Update calendar picker
            const fp = flatpickr("#block-date");
            fp.config.disable = fp.config.disable.filter(d => d !== date);
            fp.set('disable', fp.config.disable);

            displayBlockedDates();
            generateCalendar();
        }

        // Calendar state
        let currentCalendarDate = new Date();
        currentCalendarDate.setDate(1); // Start at first day of month

        // Generate calendar widget
        function generateCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Update header
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            document.getElementById('calendar-month-year').textContent = `${monthNames[month]} ${year}`;

            // Get blocked dates and bookings
            const blockedDates = JSON.parse(localStorage.getItem('blocked_dates') || '[]').map(b => b.date);
            const bookings = JSON.parse(localStorage.getItem('dj_bookings') || '[]').map(b => b.date);

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Get previous month days
            const prevMonthDays = new Date(year, month, 0).getDate();
            
            let calendarHTML = '<div class="calendar-grid">';
            
            // Day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                calendarHTML += `<div class="calendar-day-header">${day}</div>`;
            });

            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = prevMonthDays - i;
                calendarHTML += `<div class="calendar-day other-month"><span class="calendar-day-number">${day}</span></div>`;
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dateObj = new Date(year, month, day);
                dateObj.setHours(0, 0, 0, 0);
                
                let classes = 'calendar-day';
                if (dateObj.getTime() === today.getTime()) {
                    classes += ' today';
                }
                if (blockedDates.includes(dateStr)) {
                    classes += ' blocked';
                } else if (bookings.includes(dateStr)) {
                    classes += ' has-booking';
                }

                calendarHTML += `
                    <div class="${classes}" onclick="selectCalendarDate('${dateStr}')">
                        <span class="calendar-day-number">${day}</span>
                        ${(blockedDates.includes(dateStr) || bookings.includes(dateStr)) ? '<span class="calendar-day-indicator"></span>' : ''}
                    </div>
                `;
            }

            // Next month days to fill the grid
            const totalCells = firstDay + daysInMonth;
            const remainingCells = 42 - totalCells; // 6 rows * 7 days
            for (let day = 1; day <= remainingCells && day <= 14; day++) {
                calendarHTML += `<div class="calendar-day other-month"><span class="calendar-day-number">${day}</span></div>`;
            }

            calendarHTML += '</div>';
            document.getElementById('calendar-grid-container').innerHTML = calendarHTML;
        }

        // Navigate calendar months
        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            generateCalendar();
        }

        // Select date from calendar widget
        function selectCalendarDate(dateStr) {
            document.getElementById('block-date').value = dateStr;
            datePicker.setDate(dateStr);
        }

        // Load bookings
        function loadBookings() {
            // TODO: Fetch from backend API
            // For now, use sample data
            const bookings = JSON.parse(localStorage.getItem('dj_bookings') || '[]');
            
            // If no bookings, create sample data
            if (bookings.length === 0) {
                const sampleBookings = [
                    {
                        id: 1,
                        clientName: 'John & Jane Smith',
                        eventType: 'Wedding',
                        date: '2025-12-15',
                        time: '6:00 PM - 11:00 PM',
                        location: 'PeachBarn at TimberMill Acres, Tifton, GA',
                        contactEmail: 'john.smith@email.com',
                        contactPhone: '555-0123',
                        notes: 'Outdoor ceremony, indoor reception'
                    },
                    {
                        id: 2,
                        clientName: 'Sarah & Mike Johnson',
                        eventType: 'Corporate Event',
                        date: '2025-11-20',
                        time: '7:00 PM - 10:00 PM',
                        location: 'Valdosta Conference Center',
                        contactEmail: 'sarah.j@email.com',
                        contactPhone: '555-0456',
                        notes: 'Holiday party, 200 guests'
                    }
                ];
                localStorage.setItem('dj_bookings', JSON.stringify(sampleBookings));
                displayBookings(sampleBookings);
            } else {
                displayBookings(bookings);
            }
        }

        // Display bookings
        function displayBookings(bookings, filter = 'all') {
            const container = document.getElementById('bookings-container');
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let filteredBookings = bookings;
            if (filter === 'upcoming') {
                filteredBookings = bookings.filter(b => new Date(b.date) >= today);
            } else if (filter === 'past') {
                filteredBookings = bookings.filter(b => new Date(b.date) < today);
            }

            if (filteredBookings.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><p>No bookings found</p></div>';
                return;
            }

            container.innerHTML = filteredBookings.map(booking => {
                const bookingDate = new Date(booking.date);
                const isUpcoming = bookingDate >= today;
                const daysUntil = Math.ceil((bookingDate - today) / (1000 * 60 * 60 * 24));
                const showReminder = isUpcoming && daysUntil <= 14;

                const formattedDate = bookingDate.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });

                return `
                    <div class="booking-card ${isUpcoming ? 'upcoming' : 'past'}">
                        <div class="booking-header">
                            <div>
                                <div class="booking-title">${booking.clientName}</div>
                                <div class="booking-date">${formattedDate}</div>
                            </div>
                            ${showReminder ? '<span class="reminder-badge">Reminder sent</span>' : ''}
                        </div>
                        <div class="booking-details">
                            <div class="booking-detail-item">
                                <span class="booking-detail-label">Event Type</span>
                                <span class="booking-detail-value">${booking.eventType}</span>
                            </div>
                            <div class="booking-detail-item">
                                <span class="booking-detail-label">Time</span>
                                <span class="booking-detail-value">${booking.time}</span>
                            </div>
                            <div class="booking-detail-item">
                                <span class="booking-detail-label">Location</span>
                                <span class="booking-detail-value">${booking.location}</span>
                            </div>
                            <div class="booking-detail-item">
                                <span class="booking-detail-label">Contact</span>
                                <span class="booking-detail-value">${booking.contactEmail}<br>${booking.contactPhone}</span>
                            </div>
                        </div>
                        ${booking.notes ? `<div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;"><strong>Notes:</strong> ${booking.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            // Check and send reminders for upcoming bookings
            if (filter === 'all' || filter === 'upcoming') {
                checkAndSendReminders(filteredBookings);
            }
        }

        // Filter bookings
        function filterBookings(filter) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const bookings = JSON.parse(localStorage.getItem('dj_bookings') || '[]');
            displayBookings(bookings, filter);
        }

        // Check and send reminders (2 weeks prior)
        function checkAndSendReminders(bookings) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const twoWeeksFromNow = new Date(today);
            twoWeeksFromNow.setDate(twoWeeksFromNow.getDate() + 14);

            bookings.forEach(booking => {
                const bookingDate = new Date(booking.date);
                const daysUntil = Math.ceil((bookingDate - today) / (1000 * 60 * 60 * 24));

                // If booking is exactly 14 days away and reminder hasn't been sent
                if (daysUntil === 14) {
                    // TODO: Send email via backend API
                    console.log(`Sending reminder email for booking: ${booking.clientName} on ${booking.date}`);
                    // In production, this would call your backend API to send the email
                }
            });
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('dj_token');
                localStorage.removeItem('dj_user');
                window.location.href = 'dj-login.html';
            }
        }

        // Initialize - Load both calendar and bookings on page load
        generateCalendar();
        displayBlockedDates();
        loadBookings();
    </script>
</body>
</html>

